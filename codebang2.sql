use PY_CAFE
CREATE TABLE NhanVien
(
	MANV NCHAR(10) PRIMARY KEY,
	HOTEN NVARCHAR(50),
	NGAYSINH DATE,
	GIOITINH NVARCHAR(10),
	DIACHI NVARCHAR(100),
	SDT NCHAR(15),
	CHUCVU NVARCHAR(30),
	TAIKHOAN NCHAR(20),
	MATKHAU NCHAR(20),
	TRANGTHAI NVARCHAR(20)
);
CREATE TABLE KhachThanhVien
(
	MAKH NCHAR(10) PRIMARY KEY,
	HOTEN NVARCHAR(50),
	NGAYSINH DATE,
	GIOITINH NVARCHAR(10),
	SDT NCHAR(15),
	DIEMTICHLUY INT
);
CREATE TABLE SanPham
(
	MASP NCHAR(10) PRIMARY KEY,
	TENSP NVARCHAR(50),
	GIABAN DECIMAL(18,2),
	MADM NCHAR(10),
	TRANGTHAI NVARCHAR(20),
	FOREIGN KEY (MADM) REFERENCES DanhMucMonAn(MADM)
);
CREATE TABLE HoaDon
(
	MAHD NCHAR(10) PRIMARY KEY,
	NGAYLAP DATE,
	MANV NCHAR(10),
	MAKH NCHAR(10), 
	TONGTIEN DECIMAL(18,2),
	FOREIGN KEY (MANV) REFERENCES NhanVien(MANV),
	FOREIGN KEY (MAKH) REFERENCES KhachThanhVien(MAKH),

);
CREATE TABLE ChiTietHoaDon
(
	MAHD NCHAR(10),
	MASP NCHAR(10),
	SOLUONG INT,
	DONGIA DECIMAL(18,2),
	THANHTIEN DECIMAL(18,2),
	PRIMARY KEY (MAHD, MASP),
	FOREIGN KEY (MAHD) REFERENCES HoaDon(MAHD),
	FOREIGN KEY (MASP) REFERENCES SanPham(MASP)
);
CREATE TABLE TonKho
(
	MANGUYENLIEU NCHAR(10) PRIMARY KEY,
	TENNGUYENLIEU NVARCHAR(50),
	SOLUONGTON INT,
	DONVITINH NVARCHAR(20)
);
CREATE TABLE Nhap
(
	MANHAP NCHAR(10),
	NGAYNHAP DATE,
	MANV NCHAR(10),
	TONGTIEN DECIMAL(18,2),
	MANGUYENLIEU NCHAR(10),
	SOLUONG INT,
	DONGIA DECIMAL(18,2),
	THANHTIEN DECIMAL(18,2),
	PRIMARY KEY (MANHAP, MANV, MANGUYENLIEU),
	FOREIGN KEY (MANV) REFERENCES NhanVien(MANV),
	FOREIGN KEY (MANGUYENLIEU) REFERENCES TonKho(MANGUYENLIEU)
);
CREATE TABLE DanhMuc
(
	MADM NCHAR(10) PRIMARY KEY,
	TENDANHMUC NVARCHAR(50),
);

-- NHÂN VIÊN
INSERT INTO NhanVien VALUES
('NV001', N'Nguyễn Văn An', '1998-03-15', N'Nam', N'12 Lý Tự Trọng, TP.HCM', '0912345678', N'Quản lý', 'an_nv', '123456', N'Đang làm'),
('NV002', N'Lê Thị Bình', '2000-07-10', N'Nữ', N'45 Hai Bà Trưng, TP.HCM', '0987654321', N'Thu ngân', 'binh_lt', '654321', N'Đang làm'),
('NV003', N'Trần Quốc Huy', '2001-12-01', N'Nam', N'22 Pasteur, TP.HCM', '0909123123', N'Pha chế', 'huy_tq', '123123', N'Đang làm'),
('NV004', N'Phạm Thị Hoa', '1999-05-20', N'Nữ', N'101 CMT8, TP.HCM', '0909999999', N'Phục vụ', 'hoa_pt', '999999', N'Đang làm'),
('NV005', N'Ngô Đức Tín', '1997-11-09', N'Nam', N'56 Lê Lợi, TP.HCM', '0911111222', N'Pha chế', 'tin_nd', '111222', N'Đang làm');

-- KHÁCH THÀNH VIÊN
INSERT INTO KhachThanhVien VALUES
('TV001', N'Trần Hải Nam', '1997-06-22', N'Nam', '0908000111', 250),
('TV002', N'Võ Thị Yến', '1999-09-09', N'Nữ', '0933000444', 120),
('TV003', N'Phạm Minh Khang', '2002-10-10', N'Nam', '0912349999', 400);

-- DANH MỤC
INSERT INTO DanhMucMonAn VALUES
('DM01', N'Cà phê'),
('DM02', N'Sinh tố'),
('DM03', N'Nước ép'),
('DM04', N'Bánh ngọt');

-- SẢN PHẨM
INSERT INTO SanPham VALUES
('SP001', N'Cà phê đen', 25000, 'DM01', N'Còn bán'),
('SP002', N'Cà phê sữa', 30000, 'DM01', N'Còn bán'),
('SP003', N'Sinh tố bơ', 35000, 'DM02', N'Còn bán'),
('SP004', N'Nước ép cam', 32000, 'DM03', N'Còn bán'),
('SP005', N'Bánh tiramisu', 40000, 'DM04', N'Còn bán');

-- HÓA ĐƠN
INSERT INTO HoaDon VALUES
('HD001', '2025-11-01', 'NV002', 'TV001', 'B02', 95000, N'Đã thanh toán'),
('HD002', '2025-11-02', 'NV003', 'TV002', 'B03', 65000, N'Đã thanh toán'),
('HD003', '2025-11-03', 'NV002', 'TV003', 'B01', 70000, N'Chưa thanh toán');

-- CHI TIẾT HÓA ĐƠN
INSERT INTO ChiTietHoaDon VALUES
('HD001', 'SP001', 1, 25000, 25000),
('HD001', 'SP004', 2, 35000, 70000),
('HD002', 'SP002', 1, 30000, 30000),
('HD002', 'SP005', 1, 35000, 35000),
('HD003', 'SP003', 2, 35000, 70000);

-- TỒN KHO
INSERT INTO TonKho VALUES
('NL001', N'Hạt cà phê', 10, N'kg'),
('NL002', N'Sữa đặc', 5, N'lít'),
('NL003', N'Trái cây tươi', 15, N'kg');

-- NHẬP KHO
INSERT INTO Nhap VALUES
('N001', '2025-10-25', 'NV001', 250000, 'NL001', 5, 50000, 250000),
('N002', '2025-10-26', 'NV002', 100000, 'NL002', 2, 50000, 100000),
('N003', '2025-10-27', 'NV003', 210000, 'NL003', 7, 30000, 210000);

-- NHẬP DANH MỤC
INSERT INTO DanhMuc VALUES
('DM01',N'CÀ PHÊ'),
('DM02',N'TRÀ'),
('DM03',N'NƯỚC ÉP'),
('DM04',N'BÁNH KẸO'),
('DM05',N'KHÁC');
ALTER TABLE SanPham add FOREIGN KEY (MADM) REFERENCES DanhMuc(MADM)
UPDATE DANHMUC
SET TENDANHMUC = N'KHÁC'
WHERE MADM ='DM05'




USE PY_CAFE;
GO

-- Tắt tạm thời kiểm tra khóa ngoại
EXEC sp_MSforeachtable "ALTER TABLE ? NOCHECK CONSTRAINT ALL"

-- Xóa toàn bộ bảng
EXEC sp_MSforeachtable "DROP TABLE ?"

-- Bật lại kiểm tra khóa ngoại
EXEC sp_MSforeachtable "ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL"


